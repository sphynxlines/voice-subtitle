<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>帮助 - 语音字幕</title>
  
  <!-- Styles -->
  <link rel="stylesheet" href="/src/css/help.css">
  
  <style>
    /* Inline styles removed - now in /src/css/help.css */
  </style>
</head>
<body>

  <div class="container">
    <button class="back-link" onclick="goBack()">← 返回</button>
    
    <h1>📖 使用帮助</h1>

    <!-- 基本使用 -->
    <div class="section">
      <h2><span class="icon">🎤</span>如何使用</h2>
      <ol class="steps">
        <li>点击绿色的「开始」按钮</li>
        <li>第一次使用会询问麦克风权限，点击「允许」</li>
        <li>对着手机说话，文字会显示在屏幕上</li>
        <li>点击红色的「停止」按钮结束</li>
      </ol>
    </div>

    <!-- 添加到主屏幕 -->
    <div class="section">
      <h2><span class="icon">📱</span>添加到主屏幕</h2>
      <p style="margin-bottom: 15px; color: #aaa;">添加后可以像普通 App 一样使用</p>
      
      <div class="device-tabs">
        <button class="device-tab active" onclick="showDevice('android')">安卓手机</button>
        <button class="device-tab" onclick="showDevice('iphone')">苹果手机</button>
      </div>

      <div id="android" class="device-content active">
        <ol class="steps">
          <li>用 Chrome 浏览器打开本页面</li>
          <li>点击右上角菜单 <strong>⋮</strong></li>
          <li>选择「添加到主屏幕」或「安装应用」</li>
          <li>点击「添加」</li>
          <li>桌面会出现「语音字幕」图标</li>
        </ol>
      </div>

      <div id="iphone" class="device-content">
        <ol class="steps">
          <li>用 <strong>Safari</strong> 浏览器打开（不是 Chrome）</li>
          <li>点击底部的分享按钮 <strong>⬆️</strong></li>
          <li>向上滑动，找到「添加到主屏幕」</li>
          <li>点击右上角「添加」</li>
          <li>桌面会出现「语音字幕」图标</li>
        </ol>
        <div class="tip">
          ⚠️ 苹果手机必须用 Safari 浏览器，用 Chrome 或微信打开无法添加
        </div>
      </div>
    </div>

    <!-- 麦克风权限 -->
    <div class="section">
      <h2><span class="icon">🔐</span>麦克风权限</h2>
      <p style="margin-bottom: 15px; color: #aaa;">如果不小心拒绝了权限，可以这样恢复：</p>
      
      <div class="device-tabs">
        <button class="device-tab active" onclick="showDevice2('android2')">安卓手机</button>
        <button class="device-tab" onclick="showDevice2('iphone2')">苹果手机</button>
      </div>

      <div id="android2" class="device-content active">
        <p style="margin-bottom: 10px; color: #aaa;"><strong>如果已安装为 PWA 应用：</strong></p>
        <ol class="steps">
          <li>长按「语音字幕」图标</li>
          <li>点击「应用信息」或「详情」</li>
          <li>点击「权限」</li>
          <li>找到「麦克风」，选择「允许」</li>
        </ol>
        
        <p style="margin: 20px 0 10px; color: #aaa;"><strong>如果在浏览器中使用：</strong></p>
        <ol class="steps">
          <li>打开手机「设置」</li>
          <li>找到「应用管理」或「应用」</li>
          <li>找到「Chrome」或「语音字幕」</li>
          <li>点击「权限」</li>
          <li>找到「麦克风」，选择「允许」</li>
        </ol>
        
        <div class="tip" style="margin-top: 20px;">
          <strong>📱 华为 / 荣耀手机特别说明：</strong><br>
          1. 进入「设置」→「应用和服务」→「权限管理」<br>
          2. 找到「麦克风」权限<br>
          3. 找到「Chrome」或「语音字幕」，设置为「允许」<br>
          4. 如果应用被后台清理，还需要：<br>
          &nbsp;&nbsp;&nbsp;• 「设置」→「电池」→「应用启动管理」<br>
          &nbsp;&nbsp;&nbsp;• 找到应用，关闭「自动管理」<br>
          &nbsp;&nbsp;&nbsp;• 手动开启「允许后台活动」
        </div>
        
        <div class="tip" style="margin-top: 15px;">
          <strong>📱 小米 / Redmi 手机特别说明：</strong><br>
          1. 进入「设置」→「应用设置」→「应用管理」<br>
          2. 找到「Chrome」或「语音字幕」<br>
          3. 点击「权限管理」→「麦克风」→「允许」<br>
          4. 返回应用详情，点击「省电策略」<br>
          5. 选择「无限制」（防止后台被杀）<br>
          6. 如果还有问题，在「设置」→「隐私保护」→「特殊权限」中：<br>
          &nbsp;&nbsp;&nbsp;• 「后台弹出界面」→ 允许<br>
          &nbsp;&nbsp;&nbsp;• 「显示悬浮窗」→ 允许
        </div>
        
        <div class="tip" style="margin-top: 15px;">
          <strong>📱 OPPO / Vivo 手机：</strong><br>
          1. 「设置」→「应用管理」→ 找到应用<br>
          2. 「权限」→「麦克风」→「允许」<br>
          3. 「电池」→「后台冻结」→「允许后台运行」
        </div>
      </div>

      <div id="iphone2" class="device-content">
        <ol class="steps">
          <li>打开手机「设置」</li>
          <li>向下滑动找到「Safari」</li>
          <li>点击「麦克风」</li>
          <li>选择「允许」</li>
        </ol>
        <div class="tip">
          ⚠️ iOS 上的 PWA 应用权限在 Safari 设置中管理，不是独立的应用权限
        </div>
      </div>
    </div>

    <!-- 常见问题 -->
    <div class="section">
      <h2><span class="icon">❓</span>常见问题</h2>
      
      <div class="faq-item">
        <div class="faq-q">没有声音 / 不显示文字？</div>
        <div class="faq-a">请检查是否允许了麦克风权限，并确保网络连接正常。如果使用华为、小米等国产手机，请参考上方「麦克风权限」中的特别说明。</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-q">华为/小米手机应用被自动关闭？</div>
        <div class="faq-a">这些手机有严格的后台管理。需要在「电池」或「省电策略」中设置为「无限制」，并允许后台活动。详见上方「麦克风权限」部分。</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-q">识别不准确？</div>
        <div class="faq-a">尽量在安静的环境使用，说话清晰一些，手机放近一点。</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-q">应用突然停止工作？</div>
        <div class="faq-a">可能是手机系统自动清理了后台。华为、小米、OPPO、Vivo 等手机需要关闭「自动管理」并允许后台运行。</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-q">屏幕会变暗？</div>
        <div class="faq-a">正在录音时屏幕会保持常亮。如果还是变暗，可以在手机设置里延长屏幕自动锁定时间。</div>
      </div>

      <div class="faq-item">
        <div class="faq-q">显示「网络已断开」？</div>
        <div class="faq-a">请检查手机是否连接了 WiFi 或移动数据。</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-q">可以连续使用多久？</div>
        <div class="faq-a">支持长时间连续使用。系统会自动在后台刷新连接，确保会话不中断。状态栏会显示当前会话时长。</div>
      </div>
      
      <div class="faq-item">
        <div class="faq-q">看到「正在重新连接」？</div>
        <div class="faq-a">这是正常的自动维护过程，系统会自动重新连接，无需手动操作。</div>
      </div>
    </div>

  </div>

  <script>
    // Handle back navigation for both browser and PWA mode
    function goBack() {
      // Check if running as PWA
      const isPWA = window.matchMedia('(display-mode: standalone)').matches ||
                    window.navigator.standalone === true;
      
      if (isPWA) {
        // In PWA mode, close window if opened from main app, otherwise navigate
        if (window.opener) {
          window.close();
        } else {
          window.location.href = '/';
        }
      } else {
        // In browser mode, use history or navigate to home
        if (document.referrer && document.referrer.includes(window.location.host)) {
          window.history.back();
        } else {
          window.location.href = '/';
        }
      }
    }
    
    function showDevice(device) {
      document.querySelectorAll('#android, #iphone').forEach(el => {
        el.classList.remove('active');
      });
      document.getElementById(device).classList.add('active');
      
      // 更新 tab 样式
      const tabs = document.querySelectorAll('.device-tabs')[0].querySelectorAll('.device-tab');
      tabs.forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
    }

    function showDevice2(device) {
      document.querySelectorAll('#android2, #iphone2').forEach(el => {
        el.classList.remove('active');
      });
      document.getElementById(device).classList.add('active');
      
      // 更新 tab 样式
      const tabs = document.querySelectorAll('.device-tabs')[1].querySelectorAll('.device-tab');
      tabs.forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');
    }
  </script>

</body>
</html>